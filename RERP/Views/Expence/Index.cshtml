
@{
    ViewBag.Title = "Expence List";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<div class="page-content">
    <div class="container-fluid">
        <div style="text-align: right;">
            @*<a href="~/Setting/AddDepartment" class="btn btn-primary waves-effect waves-light">Create Department</a>*@
            <button class="btn btn-info" data-bs-toggle="modal" onclick="GetModal()" @*data-bs-target="#projectModal"*@>Add Expence</button>
        </div>
        <div id="partialViewContainer"></div>
        <!-- start page title -->
        <div class="row">
            <div class="col-12">
                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                    <h4 class="mb-sm-0 font-size-18">Expence List</h4>
                </div>
            </div>
        </div>
        <!-- end page title -->
        <!-- end row -->

        <br />
        <div class="row">

            <div class="col-12">
                <div class="card">
                    <div class="card-body">



                        <table id="datatable-buttons" class="table table-bordered dt-responsive nowrap w-100">
                            <thead>
                                <tr>
                                    <th style="text-align:center">Date</th>
                                    <th style="text-align:center">Expence Name</th>
                                    <th style="text-align:center">Expence Type</th>
                                    <th style="text-align:center">Expence Amount</th>
                                    <th style="text-align:center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < ViewBag.getcate.Count; i++)
                                {
                                    <tr>

                                        <td style="text-align:center">@ViewBag.getcate[i].ex_date_st</td>
                                        <td style="text-align:center">@ViewBag.getcate[i].note</td>
                                        <td style="text-align:center">@ViewBag.getcate[i].ex_name</td>
                                        <td style="text-align:center">@ViewBag.getcate[i].amount</td>
                                        <td style="text-align:center">
                                            <button class="btn btn-primary" onclick="EditRole(@ViewBag.getcate[i].expence_id)"><i class="fas fa-edit"></i></button>  <button class="btn btn-danger" onclick="deleteRole(@ViewBag.getcate[i].expence_id)"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div> <!-- end col -->
        </div> <!-- end row -->

    </div> <!-- container-fluid -->

</div>
<div id="partialContainer">
    @Html.Partial("~/Views/Shared/Partial/_ExpencePartialView.cshtml")
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function GetModal() {
        ResetData();
        $("#partialViewContainer").show();
        $('#expnsavebutton').attr('onclick', 'SubmitExpence()')
        $('#ExpnModal').modal('show');
    }
    function ResetData() {
        $('#expence_id').val('');
        $('#type_id').val('');
        $('#note').val('');
        $('#amount').val('');
        $('#remarks').val('');
        $('#ex_date').val('');
    }
    function EditRole(id) {
        debugger
        $.ajax({
            type: "GET",
            url: "/Expence/GetData/" + id,
            success: function (data) {
                // Append the loaded content to the container
                $('#expence_id').val(data.expence_id);
                $('#remarks').val(data.remarks);
                $('#ex_date').val(data.ex_date_st);
                $('#amount').val(data.amount);
                $('#note').val(data.note);
                $('#type_id').val(data.type_id);

                // Show the container
                $("#partialViewContainer").show();
                $('#expnsavebutton').attr('onclick', 'Update()')
                $('#ExpnModal').modal('show');
            },
            error: function (xhr, status, error) {

                swal.fire('Oops...', 'Something went wrong!', 'error');
            }
        });
    }
    function Update() {
        debugger

        // Update logic
        Swal.showLoading();
        var formData = new FormData();
        debugger
        // Append data to the FormData object
        formData.append('expence_id', $('#expence_id').val());
        formData.append('remarks', $('#remarks').val());
        formData.append('ex_date', $('#ex_date').val());
        formData.append('amount', $('#amount').val());
        formData.append('note', $('#note').val());
        formData.append('type_id', $('#type_id').val());
        debugger
        if ($('#type_id').val() == '' || $('#type_id').val() == null) {
            Swal.fire({
                text: "Please Enter Expence Type name!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }
        if ($('#amount').val() == '' || $('#amount').val() == null) {
            Swal.fire({
                text: "Please Enter Expence amount!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }
        if ($('#ex_date').val() == '' || $('#ex_date').val() == null) {
            Swal.fire({
                text: "Please Enter Expence amount!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }

        $.ajax({
            type: 'POST',
            url: '/Expence/UpdateCategory',
            data: formData,
            contentType: false,
            processData: false,
            success: function (result) {
                Swal.close();

                if (result.success) {

                    Swal.fire({
                        title: 'Success',
                        text: 'Data Updated successfully',
                        icon: 'success'
                    }).then((result) => {

                        if (result.isConfirmed) {

                            location.reload(true);
                        }
                    });
                } else {
                    console.log('Failure block executed');
                    alert('Failed to update entry. ' + result.errorMessage);
                }
            },

            error: function () {
                Swal.close();
                swal.fire('Oops...', 'Something went wrong!', 'error');
            }
        });


    }
    function SubmitExpence() {

        // Create logic
        Swal.showLoading();
        var formData = new FormData();
        formData.append('remarks', $('#remarks').val());
        formData.append('ex_date', $('#ex_date').val());
        formData.append('amount', $('#amount').val());
        formData.append('note', $('#note').val());
        formData.append('type_id', $('#type_id').val());

        if ($('#type_id').val() == '' || $('#type_id').val() == null) {
            Swal.fire({
                text: "Please Enter Expence Type name!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }
        if ($('#amount').val() == '' || $('#amount').val() == null) {
            Swal.fire({
                text: "Please Enter Expence amount!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }
        if ($('#ex_date').val() == '' || $('#ex_date').val() == null) {
            Swal.fire({
                text: "Please Enter Expence amount!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }


        $.ajax({
            type: 'POST',
            url: '/Expence/Save',
            data: formData,
            contentType: false,
            processData: false,
            success: function (result) {
                // Handle the success case, e.g., remove the deleted image from the table
                Swal.close();
                if (result.success) {
                    Swal.fire({
                        title: 'Success',
                        text: 'Data Insert successfully',
                        icon: 'success'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.reload();
                        }
                    });
                } else {
                    alert('Failed to Insert entry.');
                }
            },
            error: function () {
                swal.fire('Oops...', 'Something went wrong!', 'error');
            }
        });

    }
    function deleteRole(id) {
        if (confirm("Are you sure you want to delete this entry?")) {
            Swal.showLoading();
            $.ajax({
                url: '/Expence/Delete/' + id,
                type: 'POST', // You can use 'DELETE' if your server supports it
                success: function (result) {
                    // Handle the success case, e.g., remove the deleted image from the table
                    Swal.close();
                    if (result.success) {
                        Swal.fire({
                            title: 'Success',
                            text: 'Data deleted successfully',
                            icon: 'success'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.reload();
                            }
                        });
                    } else {
                        alert('Failed to delete entry.');
                    }
                },
                error: function () {
                    swal.fire('Oops...', 'Something went wrong!', 'error');
                }
            });
        }
    }
</script>
