
@{
    ViewBag.Title = "Sub Category List";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<div class="page-content">
    <div class="container-fluid">
        <div style="text-align: right;">
            @*<a href="~/Setting/AddDepartment" class="btn btn-primary waves-effect waves-light">Create Department</a>*@
            <button class="btn btn-info" data-bs-toggle="modal" onclick="GetModal()" @*data-bs-target="#projectModal"*@>Add Sub Cetagory</button>
        </div>
        <div id="partialViewContainer"></div>
        <!-- start page title -->
        <div class="row">
            <div class="col-12">
                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                    <h4 class="mb-sm-0 font-size-18">Sub Category List</h4>
                </div>
            </div>
        </div>
        <!-- end page title -->
        <!-- end row -->

        <br />
        <div class="row">

            <div class="col-12">
                <div class="card">
                    <div class="card-body">



                        <table id="datatable-buttons" class="table table-bordered dt-responsive nowrap w-100">
                            <thead>
                                <tr>
                                    <th style="text-align:center">Sub Category Name</th>
                                    <th style="text-align:center">Category Name</th>
                                    <th style="text-align:center">Status</th>
                                    <th style="text-align:center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < ViewBag.getcate.Count; i++)
                                {
                                    <tr>
                                        <td style="text-align:center">@ViewBag.getcate[i].sub_cate_name</td>
                                        <td style="text-align:center">@ViewBag.getcate[i].cate_name</td>
                                        <td style="text-align:center">
                                            @if (ViewBag.getcate[i].is_active == true)
                                            {
                                                <span class="badge bg-success">Active</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-warning">Inactive</span>
                                            }
                                        </td>
                                        <td style="text-align:center">
                                            <button class="btn btn-primary" onclick="EditRole(@ViewBag.getcate[i].sub_cate_id)"><i class="fas fa-edit"></i></button>  <button class="btn btn-danger" onclick="deleteRole(@ViewBag.getcate[i].sub_cate_id)"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div> <!-- end col -->
        </div> <!-- end row -->

    </div> <!-- container-fluid -->

</div>
<div id="partialContainer">
    @Html.Partial("~/Views/Shared/Partial/_SubCategoryPartialView.cshtml")
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function GetModal() {
        ResetData();
        $("#partialViewContainer").show();
        $('#savebutton').attr('onclick', 'Submit()')
        $('#CateModal').modal('show');
    }
    function ResetData() {
        $('#sub_cate_id').val('');
        $('#sub_cate_name').val('');
        $('#cate_id').val('');
        $('#is_active').is(':checked');

    }
    function EditRole(sub_cate_id) {
        debugger
        $.ajax({
            type: "GET",
            url: "/SubCategory/GetData/" + sub_cate_id,
            success: function (data) {
                // Append the loaded content to the container
                $('#sub_cate_id').val(data.sub_cate_id);
                $('#sub_cate_name').val(data.sub_cate_name);
                $('#cate_id').val(data.cate_id);
                $('#is_active').prop('checked', data.is_active);

                // Show the container
                $("#partialViewContainer").show();
                $('#savebutton').attr('onclick', 'Update()')
                $('#CateModal').modal('show');
            },
            error: function (xhr, status, error) {

                swal.fire('Oops...', 'Something went wrong!', 'error');
            }
        });
    }
    function Update() {
        // Update logic
        Swal.showLoading();
        var formData = new FormData();
        // Append data to the FormData object
        formData.append('sub_cate_id', $('#sub_cate_id').val());
        formData.append('sub_cate_name', $('#sub_cate_name').val());
        formData.append('cate_id', $('#cate_id').val());
        formData.append('is_active', $('#is_active').is(':checked'));
        
        if ($('#sub_cate_name').val() == '' || $('#sub_cate_name').val() == null) {
            Swal.fire({
                text: "Please Enter Sub Category name!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }
        if ($('#cate_id').val() == '' || $('#cate_id').val() == null) {
            Swal.fire({
                text: "Please Select Category!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }

        $.ajax({
            type: 'POST',
            url: '/SubCategory/UpdateCategory',
            data: formData,
            contentType: false,
            processData: false,
            success: function (result) {
                Swal.close();

                if (result.success) {

                    Swal.fire({
                        title: 'Success',
                        text: 'Data Updated successfully',
                        icon: 'success'
                    }).then((result) => {

                        if (result.isConfirmed) {

                            location.reload(true);
                        }
                    });
                } else {
                    console.log('Failure block executed');
                    alert('Failed to update entry. ' + result.errorMessage);
                }
            },

            error: function () {
                Swal.close();
                swal.fire('Oops...', 'Something went wrong!', 'error');
            }
        });


    }
    function Submit() {

        // Create logic
        Swal.showLoading();
        var formData = new FormData();
        formData.append('sub_cate_name', $('#sub_cate_name').val());
        formData.append('cate_id', $('#cate_id').val());
        formData.append('is_active', $('#is_active').is(':checked'));

        if ($('#sub_cate_name').val() == '' || $('#sub_cate_name').val() == null) {
            Swal.fire({
                text: "Please Enter Sub Category name!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }
        if ($('#cate_id').val() == '' || $('#cate_id').val() == null) {
            Swal.fire({
                text: "Please Select Category!",
                title: "Warning!",
                icon: 'error',
            });

            return false;
        }


        $.ajax({
            type: 'POST',
            url: '/SubCategory/Save',
            data: formData,
            contentType: false,
            processData: false,
            success: function (result) {
                // Handle the success case, e.g., remove the deleted image from the table
                Swal.close();
                if (result.success) {
                    Swal.fire({
                        title: 'Success',
                        text: 'Data Insert successfully',
                        icon: 'success'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            window.location.reload();
                        }
                    });
                } else {
                    alert('Failed to Insert entry.');
                }
            },
            error: function () {
                swal.fire('Oops...', 'Something went wrong!', 'error');
            }
        });

    }
    function deleteRole(id) {
        if (confirm("Are you sure you want to delete this entry?")) {
            Swal.showLoading();
            $.ajax({
                url: '/SubCategory/Delete/' + id,
                type: 'POST', // You can use 'DELETE' if your server supports it
                success: function (result) {
                    // Handle the success case, e.g., remove the deleted image from the table
                    Swal.close();
                    if (result.success) {
                        Swal.fire({
                            title: 'Success',
                            text: 'Data deleted successfully',
                            icon: 'success'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.reload();
                            }
                        });
                    } else {
                        alert('Failed to delete entry.');
                    }
                },
                error: function () {
                    swal.fire('Oops...', 'Something went wrong!', 'error');
                }
            });
        }
    }
</script>
